const _listInput=get(".gen"),_message=get("#error"),_copyright="// File created with [ https://github.com/n-deleforge/class-manager-generator ]";let tableName,tableID,columnsName,className,dbType,dbConnect;function generateClass(){return"<?php\n"+_copyright+"\n\nlass "+className+"\n{\n"+generateAttributes()+"\n"+generateGetterSetter()+"\n"+genererConstruct()+"\n\n}"}function generateAttributes(){let e="";for(let n=0;n<columnsName.length;n++)e+="private $_"+columnsName[n]+";\n";return e}function generateGetterSetter(){let e="";for(let n=0;n<columnsName.length;n++)e+="public function get"+ucFirst(columnsName[n])+"()\n{\n return $this->_"+columnsName[n]+";\n}\n",e+="public function set"+ucFirst(columnsName[n])+"($_"+columnsName[n]+")\n{\n return $this->_"+columnsName[n]+" = $_"+columnsName[n]+";\n}\n";return e}function genererConstruct(){return'public function __construct(array $options = [])\n{\nif (!empty($options))\n{\n$this->hydrate($options);\n}\n}\npublic function hydrate($data)\n{\nforeach ($data as $key => $value) {\n$method = "set" . ucfirst($key);\nif (is_callable(([$this, $method])))\n{\n$this->$method($value);\n}\n}\n}'}function generateManager(){const e=columnsName.find(e=>e==tableID);return"undefined"!=e&&columnsName.splice(columnsName.indexOf(e),1),"<?php\n"+_copyright+"\n\nclass "+className+"Manager\n{\n"+generateAdd()+"\n\n"+generateUpdate()+"\n\n"+generateDelete()+"\n\n"+generateFindById()+"\n\n"+generateGetList()+"\n\n}"}function generateAdd(){let e="",n="",t="";for(let a=0;a<columnsName.length;a++)e+=columnsName[a]+",",n+=":"+columnsName[a]+",",t+='$q->bindValue(":'+columnsName[a]+'", $obj->get'+ucFirst(columnsName[a])+"());\n";return e=e.substr(0,e.length-1),n=n.substr(0,n.length-1),"public static function add("+className+' $obj)\n{\n$db = DbConnect::getDb();\n$q = $db->prepare("INSERT INTO '+tableName+" ("+e+") VALUES ("+n+')");\n'+t+"$q->execute();\n}"}function generateUpdate(){let e="",n="";for(let t=0;t<columnsName.length;t++)e+=columnsName[t]+"=:"+columnsName[t]+", ",n+='$q->bindValue(":'+columnsName[t]+'", $obj->get'+ucFirst(columnsName[t])+"());\n";return n+='$q->bindValue(":'+tableID+'", $obj->get'+ucFirst(tableID)+"());\n",e=e.substr(0,e.length-2),"public static function update("+className+' $obj)\n{\n$db = DbConnect::getDb();\n$q = $db->prepare("UPDATE '+tableName+" SET "+e+" WHERE "+tableID+"=:"+tableID+'");\n'+n+"$q->execute();\n}"}function generateDelete(){return"public static function delete("+className+' $obj)\n{\n$db = DbConnect::getDb();\n$db->exec("DELETE FROM '+tableName+" WHERE "+tableID+"=$obj->get"+ucFirst(tableID)+'()");\n}'}function generateFindById(){return'public static function findById($id)\n{\n$db = DbConnect::getDb();\n$id = (int) $id;\n$q = $db->query("SELECT * FROM '+tableName+" WHERE "+tableID+'=$id");\n$results = $q->'+("mariadb"==dbType?"fetch":"fetcharray")+"(PDO::"+("mariadb"==dbType?"FETCH_ASSOC":"FETCH_OBJ")+");\nreturn ($results != false) ? new "+className+" ($results) : false;\n}"}function generateGetList(){return'public static function getList()\n{\n$db = DbConnect::getDb();\n$arr = [];\n$q = $db->query("SELECT * FROM '+tableName+'");\nwhile ($donnees = $q->'+("mariadb"==dbType?"fetch":"fetcharray")+"(PDO::"+("mariadb"==dbType?"FETCH_ASSOC":"FETCH_OBJ")+")) if ($donnees != false) $arr[] = new "+className+"($donnees);\nreturn $arr;\n}"}function generateDbConnect(){const e="<?php\n"+_copyright+"\n\nclass DbConnect\n{\nprivate static $db;\n\npublic static function getDb()\n{\nreturn DbConnect::$db;\n}\n\npublic static function init()\n{\n";return"mariadb"==dbType?e+"$host = '';\n$base = '';\n$user = '';\n$pass = '';\n\ntry {\nself::$db = new PDO('mysql:host=' . $host . '; dbname=' . $base . ';charset=utf8mb4', $user, $pass);\nself::$db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n} catch (Exception $e) {\ndie();\n}\n}\n}":e+"$path = '';\n\ntry {\nself::$db = new SQLite3($path);\n} catch (Exception $e) {\ndie();\n}\n}\n}"}get("#reset").addEventListener("click",()=>{_message.style.visibility="hidden",get("#dbType").selectedIndex=0,get("#dbConnect").selectedIndex=0;for(let e=0;e<_listInput.length;e++)_listInput[e].value=""}),get("#generate").addEventListener("click",()=>{let e=0;for(let n=0;n<_listInput.length;n++)""===_listInput[n].value&&e++;0==e?(_message.style.visibility="visible",_message.innerHTML=_content.downloading,tableName=get("#tableName").value,tableID=get("#tableId").value,className=ucFirst(get("#className").value),columnsName=get("#columnsName").value.split(","),dbType=get("#dbType").value,dbConnect=get("#dbConnect").value,download(generateClass(),className+".Class.php"),download(generateManager(),className+"Manager.Class.php"),"true"==dbConnect&&download(generateDbConnect(),"DbConnect.Class.php")):_message.style.visibility="visible"});